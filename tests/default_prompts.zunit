#!/usr/bin/env zunit

@test 'Testing production of default prompts from ZPML' {
	load ../agkozak-zsh-theme.plugin.zsh

	AGKOZAK_HAS_COLORS=1

	set_macro custom_whitespace '${AGKOZAK_PROMPT_WHITESPACE}'

	AGKOZAK_ZPML_PROMPT=(
	  if is_exit_0 then
	  else
	    bold fg_${AGKOZAK_COLORS_EXIT_STATUS} exit_status unfg unbold space
	  fi

	  if is_superuser then
	    reverse bold
	  else
	    bold fg_${AGKOZAK_COLORS_USER_HOST}                # Default: green
	  fi

	  user_host

	  if is_superuser then
	    unbold unreverse
	  else
	    unfg unbold
	  fi

	  space
	  bold fg_${AGKOZAK_COLORS_PATH} pwd unfg unbold       # Default: blue
	  custom_whitespace                                    # Default: newline

	  vi_mode_indicator space
	)

	AGKOZAK_ZPML_RPROMPT=(                                # Default: yellow
	  fg_${AGKOZAK_COLORS_BRANCH_STATUS} git_branch_status unfg
	)

	assert "$(_agkozak_construct_prompt AGKOZAK_ZPML_PROMPT)" same_as '%(?..%B%F{red}(%?%)%f%b )%(!.%S%B.%B%F{green})%n%1v%(!.%b%s.%f%b) %B%F{blue}%2v%f%b${AGKOZAK_PROMPT_WHITESPACE}$(_agkozak_vi_mode_indicator) '

	assert "$(_agkozak_construct_prompt AGKOZAK_ZPML_RPROMPT)" same_as '%F{yellow}%3v%f'
}
